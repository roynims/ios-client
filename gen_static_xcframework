PROJECT_DIR=.
PROJECT_NAME=Split
SCHEMA_NAME=Splitlib
# set framework folder name
FRAMEWORK_FOLDER_NAME="${PROJECT_NAME}_XCFramework"
# set framework name or read it from project by this variable
FRAMEWORK_NAME="${PROJECT_NAME}"
#xcframework path
FRAMEWORK_PATH="${PROJECT_DIR}/${FRAMEWORK_FOLDER_NAME}/${FRAMEWORK_NAME}.xcframework"
# set path for iOS simulator archive
SIMULATOR_ARCHIVE_PATH="${PROJECT_DIR}/${FRAMEWORK_FOLDER_NAME}/simulator"
# set path for iOS device archive
IOS_DEVICE_ARCHIVE_PATH="${PROJECT_DIR}/${FRAMEWORK_FOLDER_NAME}/device"
OUTPUT_FOLDER="${PROJECT_DIR}/${FRAMEWORK_FOLDER_NAME}"

rm -rf ${OUTPUT_FOLDER}
echo "Deleted ${FRAMEWORK_FOLDER_NAME}"

mkdir "${FRAMEWORK_FOLDER_NAME}"
echo "Created ${FRAMEWORK_FOLDER_NAME}"
echo "Archiving ${FRAMEWORK_NAME} as ${SIMULATOR_ARCHIVE_PATH}"
xcodebuild build -scheme ${SCHEMA_NAME} -destination="iOS Simulator" -derivedDataPath ".${SIMULATOR_ARCHIVE_PATH}" -sdk iphonesimulator SKIP_INSTALL=NO BUILD_LIBRARIES_FOR_DISTRIBUTION=YES
echo "Archiving ${FRAMEWORK_NAME} as ${IOS_DEVICE_ARCHIVE_PATH}"
xcodebuild build -scheme ${SCHEMA_NAME} -destination="iOS"  -derivedDataPath ".${IOS_DEVICE_ARCHIVE_PATH}" -sdk iphoneos SKIP_INSTALL=NO BUILD_LIBRARIES_FOR_DISTRIBUTION=YES    
#Creating XCFramework
echo "Creating XCFramework from ${SIMULATOR_ARCHIVE_PATH} and ${IOS_DEVICE_ARCHIVE_PATH} into ${FRAMEWORK_PATH}"
xcodebuild -create-xcframework -library .${SIMULATOR_ARCHIVE_PATH}/Build/Products/Debug-iphonesimulator/lib${SCHEMA_NAME}.a -library .${IOS_DEVICE_ARCHIVE_PATH}/Build/Products/Debug-iphoneos/lib${SCHEMA_NAME}.a -output "${FRAMEWORK_PATH}"